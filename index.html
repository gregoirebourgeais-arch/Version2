<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Atelier PPNC - Production lignes</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#005bff" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

  <link rel="stylesheet" href="style.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("service-worker.js")
          .catch((err) => console.error("SW registration failed", err));
      });
    }
  </script>
</head>

<body>
  <header class="app-header">
    <div class="app-title">
      <span class="app-main-title">Atelier PPNC</span>
      <span class="app-sub-title">Suivi Production & Arr√™ts</span>
    </div>
    <div class="header-info" id="header-datetime">
      <!-- inject√© JS -->
    </div>
    <div class="header-actions">
      <button id="settingsToggle" class="icon-btn" title="Param√®tres et s√©curit√©">‚öôÔ∏è</button>
      <select id="equipeSelector" class="equipe-selector">
        <option value="M">√âquipe M</option>
        <option value="AM">√âquipe AM</option>
        <option value="N">√âquipe N</option>
      </select>
      <button id="themeToggleBtn" class="theme-toggle">üåó Th√®me</button>
    </div>
  </header>

  <!-- Barre de navigation -->
  <nav class="top-nav">
    <button class="nav-btn active" data-section="atelier">Atelier</button>
    <button class="nav-btn" data-section="production">Production</button>
    <button class="nav-btn" data-section="arrets">Arr√™ts</button>
    <button class="nav-btn" data-section="organisation">Organisation</button>
    <button class="nav-btn" data-section="personnel">Personnel</button>
    <button class="nav-btn" data-section="validation">Validation DDM</button>
    <button class="nav-btn" data-section="historique">Historique √©quipes</button>
    <button class="nav-btn" data-section="manager">Manager (base d√©di√©e)</button>
    <button class="nav-btn" data-section="planning">Planning</button>
  </nav>

  <main>
    <!-- PAGE ATELIER -->
    <section id="section-atelier" class="section visible">
      <h2>Vue d'ensemble Atelier</h2>

      <div class="atelier-grid">
        <div class="card">
          <h3>Production par ligne (aujourd'hui)</h3>
          <div id="atelier-lines-summary"></div>
        </div>

        <div class="card">
          <h3>√âvolution des cadences</h3>
          <canvas id="atelierChart"></canvas>
          <p class="helper-text">
            Une courbe par ligne, bas√©e sur les enregistrements de production.
          </p>
        </div>

        <div class="card">
          <h3>Arr√™ts principaux</h3>
          <div class="table-wrapper-horizontal">
            <table class="table" id="atelier-arrets-table">
              <thead>
                <tr>
                  <th>Ligne</th>
                  <th>Sous-ligne</th>
                  <th>Machine</th>
                  <th>Dur√©e (min)</th>
                  <th>Commentaire</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h3>Export Excel</h3>
          <p class="helper-text">
            Export pour pr√©sentation en r√©union (5 onglets : Synth√®se, Production, Arr√™ts, Organisation, Personnel).
          </p>

          <button id="exportPresentationBtn" class="primary-btn" style="margin-bottom: 15px;">
            üìà Export PR√âSENTATION
          </button>

          <p class="helper-text" style="margin-top: 20px;">
            RAZ d'√©quipe : exporte DATA + PR√âSENTATION de l'√©quipe finissante, puis reset complet.
          </p>

          <button id="razBtn" class="danger-btn">
            üîÑ RAZ √©quipe (double export + reset)
          </button>
        </div>
      </div>
    </section>

    <!-- PAGE PRODUCTION -->
    <section id="section-production" class="section">
      <div class="production-layout">
        <aside class="lines-sidebar">
          <h3>Lignes</h3>
          <div class="lines-list" id="linesList"></div>
        </aside>

        <div class="line-content">
          <h2 id="currentLineTitle">Ligne</h2>

          <div class="card">
            <h3>Saisie production</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="prodStartTime">Heure d√©but</label>
                <input type="time" id="prodStartTime" />
              </div>

              <div class="form-group">
                <label for="prodEndTime">Heure fin</label>
                <input type="time" id="prodEndTime" />
              </div>

              <div class="form-group">
                <label for="prodQuantity">Quantit√© produite (colis)</label>
                <input type="number" id="prodQuantity" min="0" />
              </div>

              <div class="form-group">
                <label for="prodCodeArticle">Code article (optionnel)</label>
                <input type="text" id="prodCodeArticle" />
              </div>

              <div class="form-group">
                <label for="prodRemaining">Quantit√© restante (colis)</label>
                <input type="number" id="prodRemaining" min="0" />
              </div>

              <div class="form-group">
                <label for="prodCadenceManual">Cadence manuelle (colis/h)</label>
                <input type="number" id="prodCadenceManual" min="0" step="0.01" />
              </div>

              <div class="form-group">
                <label for="prodArretMinutes">Arr√™ts (min)</label>
                <input type="number" id="prodArretMinutes" min="0" />
              </div>

              <div class="form-group form-group-wide">
                <label for="prodComment">Commentaire</label>
                <textarea id="prodComment" rows="2"></textarea>
              </div>
            </div>

            <div class="info-row">
              <div>
                <strong>Cadence :</strong>
                <span id="prodCadenceDisplay">-</span> colis/heure
              </div>
              <div>
                <strong>Temps restant :</strong>
                <span id="prodRemainingTimeDisplay">-</span>
              </div>
            </div>

            <div class="buttons-row">
              <button id="prodSaveBtn" class="primary-btn">üíæ Enregistrer</button>
              <button id="prodUndoBtn" class="secondary-btn">‚Ü©Ô∏è Annuler dernier</button>
            </div>
          </div>

          <div class="card">
            <h3>Historique de la ligne</h3>
            <div class="table-wrapper-horizontal">
              <table class="table" id="prodHistoryTable">
                <thead>
                  <tr>
                    <th>Date/Heure</th>
                    <th>√âquipe</th>
                    <th>D√©but</th>
                    <th>Fin</th>
                    <th>Qt√©</th>
                    <th>Arr√™t</th>
                    <th>Cadence</th>
                    <th>Temps restant</th>
                    <th>Commentaire</th>
                    <th>Article</th>
                    <th>Suppr.</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- PAGE ARRETS -->
    <section id="section-arrets" class="section">
      <div class="card">
        <h2>Nouvel arr√™t</h2>

        <div class="form-row">
          <label for="arretLine">Ligne impact√©e :</label>
          <select id="arretLine"></select>
        </div>

        <div class="form-row">
          <label for="arretSousZone">Sous-zone :</label>
          <select id="arretSousZone"></select>
        </div>

        <div class="form-row">
          <label for="arretMachine">Machine :</label>
          <select id="arretMachine"></select>
        </div>

        <div class="form-row">
          <label for="arretArticle">Code article (optionnel)</label>
          <input type="text" id="arretArticle" />
        </div>

        <div class="form-row">
          <label for="arretDuration">Dur√©e (min) :</label>
          <input type="number" id="arretDuration" min="0" />
        </div>

        <div class="form-row">
          <label for="arretComment">Commentaire :</label>
          <textarea id="arretComment" rows="3"></textarea>
        </div>

        <button id="arretSaveBtn" class="primary-btn">üíæ Enregistrer l'arr√™t</button>
      </div>

      <div class="card">
        <h2>Historique des arr√™ts</h2>
        <div class="table-wrapper">
          <table id="arretsHistoryTable" class="data-table">
            <thead>
              <tr>
                <th>Date/Heure</th>
                <th>Ligne</th>
                <th>Sous-zone</th>
                <th>Machine</th>
                <th>Article</th>
                <th>Dur√©e (min)</th>
                <th>Commentaire</th>
                <th>Suppr.</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- PAGE ORGANISATION -->
    <section id="section-organisation" class="section">
      <h2>Organisation / Consignes</h2>

      <div class="card">
        <h3>Nouvelle consigne</h3>
        <div class="form-grid">
          <div class="form-group form-group-wide">
            <label for="orgConsigne">Consigne</label>
            <textarea id="orgConsigne" rows="3"></textarea>
          </div>

          <div class="form-group">
            <label for="orgVisa">Visa</label>
            <input type="text" id="orgVisa" />
          </div>
        </div>

        <div class="buttons-row">
          <button id="orgSaveBtn" class="primary-btn">üíæ Enregistrer consigne</button>
        </div>
      </div>

      <div class="card">
        <h3>Historique des consignes</h3>
        <table class="table" id="orgHistoryTable">
          <thead>
            <tr>
              <th>Date/Heure</th>
              <th>√âquipe</th>
              <th>Consigne</th>
              <th>Visa</th>
              <th>Valid√©e ?</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- PAGE PERSONNEL -->
    <section id="section-personnel" class="section">
      <h2>Personnel</h2>

      <div class="card">
        <h3>√âv√©nement personnel</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="persNom">Nom</label>
            <input type="text" id="persNom" />
          </div>

          <div class="form-group">
            <label for="persMotif">Motif</label>
            <select id="persMotif">
              <option value="Absence">Absence</option>
              <option value="Retard">Retard</option>
              <option value="D√©part">D√©part</option>
              <option value="Autre">Autre</option>
            </select>
          </div>

          <div class="form-group form-group-wide">
            <label for="persComment">Commentaire</label>
            <textarea id="persComment" rows="2"></textarea>
          </div>
        </div>

        <div class="buttons-row">
          <button id="persSaveBtn" class="primary-btn">üíæ Enregistrer</button>
        </div>
      </div>

      <div class="card">
        <h3>Historique personnel</h3>
        <table class="table" id="persHistoryTable">
          <thead>
            <tr>
              <th>Date/Heure</th>
              <th>√âquipe</th>
              <th>Nom</th>
              <th>Motif</th>
              <th>Commentaire</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- PAGE VALIDATION DDM -->
    <section id="section-validation" class="section">
      <h2>Validation DDM</h2>

      <div class="card">
        <h3>Calcul de la DDM</h3>

        <div class="form-grid">
          <div class="form-group">
            <label for="ddmQuantieme">Quanti√®me fabrication</label>
            <input type="number" id="ddmQuantieme" min="1" max="366" placeholder="Ex: 100" />
          </div>

          <div class="form-group">
            <label for="ddmAnnee">Ann√©e fabrication</label>
            <input type="number" id="ddmAnnee" placeholder="Ex: 2024" />
          </div>

          <div class="form-group">
            <label for="ddmDuree">Dur√©e de vie (jours)</label>
            <input type="number" id="ddmDuree" min="0" placeholder="Ex: 90" />
          </div>
        </div>

        <div class="buttons-row">
          <button id="ddmCalcBtn" class="primary-btn">üßÆ Calculer DDM</button>
        </div>

        <p class="ddm-result">
          DDM calcul√©e : <strong id="ddmResult">-</strong>
        </p>
      </div>
    </section>

    <!-- PAGE HISTORIQUE EQUIPES -->
    <section id="section-historique" class="section">
      <div class="card">
        <h2>Historique des √©quipes</h2>

        <label for="historySelect">√âquipe / p√©riode enregistr√©e :</label>
        <select id="historySelect">
          <option value="">-- S√©lectionner --</option>
        </select>
        <div id="historyFolderStatus" class="import-status helper-text"></div>
      </div>

      <div class="card">
        <h3>Vue d'ensemble</h3>
        <div id="history-lines-summary" class="summary-grid"></div>
      </div>

      <div class="card">
        <h3>√âvolution des cadences</h3>
        <canvas id="historyChart"></canvas>
      </div>

      <div class="card">
        <h3>Arr√™ts (classement par dur√©e)</h3>
        <table id="history-arrets-table" class="data-table">
          <thead>
            <tr>
              <th>Ligne</th>
              <th>Sous-ligne</th>
              <th>Machine</th>
              <th>Dur√©e (min)</th>
              <th>Commentaire</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card" id="history-organisation" style="display: none;">
        <h3>Organisation / Consignes</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Date/Heure</th>
              <th>√âquipe</th>
              <th>Consigne</th>
              <th>Visa</th>
              <th>Valid√©e</th>
              <th>Supprimer</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card" id="history-personnel" style="display: none;">
        <h3>Personnel</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Date/Heure</th>
              <th>√âquipe</th>
              <th>Nom</th>
              <th>Motif</th>
              <th>Commentaire</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- PAGE MANAGER (base d√©di√©e) -->
    <section id="section-manager" class="section">
      <h2>Base manager (ind√©pendante & locale)</h2>
      <p class="helper-text">
        Importe les fichiers Excel et recopie toutes les lignes dans un classeur unique g√©n√©r√© par l'application. La
        recherche parcourt l'int√©gralit√© de l'historique stock√© dans ce classeur, sans d√©pendance r√©seau.
      </p>

      <div class="manager-grid" id="managerContent">
        <div class="card">
          <h3>Import vers la base manager</h3>
          <div class="info-bubble">
            <button type="button" class="icon-btn info-toggle" id="managerInfoToggle" title="D√©tails de la mise √† jour">‚ÑπÔ∏è D√©tails</button>
            <div class="info-bubble__content hidden" id="managerInfoContent">
              Les fichiers peuvent arriver √† tout moment (jusqu'√† plusieurs par √©quipe). Clique sur ¬´ Mise √† jour ¬ª pour
              scanner un dossier (ex : honor200 ‚ûú Documents) et ne r√©cup√©rer que les fichiers Excel non encore import√©s.
              Une v√©rification automatique relance ce scan toutes les 30 minutes si le dossier est autoris√©.
            </div>
          </div>
          <div class="import-actions">
            <input type="file" id="managerExcelInput" accept=".xlsx,.xls" multiple />
            <button id="managerScanBtn" class="primary-btn">üìÇ Mise √† jour (scanne un dossier)</button>
            <button id="managerImportBtn" class="secondary-btn" title="Importer manuellement plusieurs fichiers">
              üì• Importer une s√©lection
            </button>
            <button id="managerExportBtn" class="secondary-btn" title="T√©l√©charger le classeur historis√©">üìë Export Excel</button>
            <button id="managerResetBtn" class="danger-btn" title="Effacer la base manager (pas les autres formulaires)">üóëÔ∏è Vider la base</button>
          </div>
          <div id="managerImportStatus" class="import-status helper-text"></div>
          <div id="managerFolderStatus" class="import-status helper-text"></div>

        </div>

        <div class="card" id="managerSearchCard">
          <h3>Recherche et tri</h3>
          <p class="helper-text">Tape un mot-cl√© ou combine plusieurs filtres. La recherche couvre tous les champs de l'historique.</p>
          <div class="form-grid import-filters">
            <div class="form-group">
              <label for="managerSearchInput">Recherche texte</label>
              <input type="text" id="managerSearchInput" placeholder="Tape ici pour chercher dans la base" />
            </div>
            <div class="form-group">
              <label for="managerEquipeFilter">√âquipe</label>
              <select id="managerEquipeFilter">
                <option value="">Toutes</option>
                <option value="M">M</option>
                <option value="AM">AM</option>
                <option value="N">N</option>
              </select>
            </div>
            <div class="form-group">
              <label for="managerLineFilter">Ligne</label>
              <select id="managerLineFilter">
                <option value="">Toutes</option>
              </select>
            </div>
            <div class="form-group">
              <label for="managerSortField">Tri</label>
              <select id="managerSortField"></select>
            </div>
            <div class="form-group">
              <label for="managerSortDir">Ordre</label>
              <select id="managerSortDir">
                <option value="desc">D√©croissant</option>
                <option value="asc">Croissant</option>
              </select>
            </div>
            <div class="form-group">
              <label for="managerDateStart">D√©but p√©riode (Pareto)</label>
              <input type="date" id="managerDateStart" />
            </div>
            <div class="form-group">
              <label for="managerDateEnd">Fin p√©riode (Pareto)</label>
              <input type="date" id="managerDateEnd" />
            </div>
            <div class="form-group">
              <label for="managerParetoLine">Ligne (Pareto)</label>
              <select id="managerParetoLine">
                <option value="">Toutes</option>
              </select>
            </div>
            <div class="form-group pareto-action">
              <label>&nbsp;</label>
              <button id="managerParetoBtn" class="secondary-btn" type="button">üìä Afficher le Pareto des arr√™ts</button>
            </div>
          </div>

          <div class="manager-active-filters" id="managerActiveFilters"></div>
          <div class="field-selector" id="managerFieldSelector"></div>
          <p class="helper-text" id="managerResultsCount"></p>
        </div>
      </div>

      <div class="card" id="managerResultsCard">
        <div class="manager-results-header">
          <div>
            <h3>R√©sultats (base manager)</h3>
            <p class="helper-text">Affichage enrichi avec rappel des m√©tadonn√©es fichier (quanti√®me, semaine, heure).</p>
          </div>
          <div class="manager-result-badges" id="managerResultBadges"></div>
        </div>

        <div class="manager-results-grid">
          <div class="manager-stats" id="managerStats"></div>

          <div class="table-wrapper-horizontal">
            <table class="table manager-table" id="managerResultsTable">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Date/Heure</th>
                  <th>√âquipe</th>
                  <th>Ligne</th>
                  <th>Sous-ligne</th>
                  <th>Machine</th>
                  <th>Quantit√©</th>
                  <th>Arr√™t (min)</th>
                  <th>Cadence</th>
                  <th>Commentaire</th>
                  <th>Article</th>
                  <th>Personnel</th>
                  <th>Motif</th>
                  <th>Fichier (Q/S/H)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card" id="managerParetoCard" style="display: none;">
        <div class="manager-results-header">
          <div>
            <h3 id="managerParetoTitle">Pareto des arr√™ts</h3>
            <p class="helper-text" id="managerParetoSubtitle">Camembert bas√© sur les arr√™ts (minutes) filtr√©s par p√©riode ou ligne.</p>
          </div>
          <div class="manager-result-badges" id="managerParetoBadges"></div>
        </div>
        <div class="pareto-chart-wrapper">
          <canvas id="managerPareto"></canvas>
        </div>
        <p class="helper-text pareto-click-info" id="managerParetoClickInfo"></p>
        <div class="pareto-actions">
          <button id="managerParetoBackToTop" class="secondary-btn" type="button">‚¨ÜÔ∏è Haut de page</button>
        </div>
      </div>
    </section>

    <!-- PAGE PLANNING -->
    <section id="section-planning" class="section">
      <div class="planning-header">
        <h2>Planning (Gantt) - Lundi ‚Üí Samedi matin</h2>
        <div class="planning-header-actions">
          <label>
            Semaine
            <input type="number" id="planningWeekNumber" min="1" max="53" />
          </label>
          <label>
            Lundi de r√©f√©rence
            <input type="date" id="planningWeekStart" />
          </label>
          <button class="secondary-btn" id="planningRebuildBtn">üîÑ Recalage auto</button>
          <button class="primary-btn" id="planningValidateBtn">‚úÖ Valider le planning</button>
        </div>
      </div>

      <div class="planning-grid">
        <div class="card">
          <h3>Param√©trage</h3>
          <div class="planning-settings">
            <details open>
              <summary>Arr√™ts pr√©vus</summary>
              <div class="form-grid">
                <label>Type
                  <select id="planningArretType">
                    <option value="Pause">Pause</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="R√©union">R√©union</option>
                    <option value="Autre">Autre</option>
                  </select>
                </label>
                <label>Ligne
                  <select id="planningArretLine"></select>
                </label>
                <label>Jour
                  <select id="planningArretDay">
                    <option value="ALL">Tous les jours</option>
                    <option value="0">Lundi</option>
                    <option value="1">Mardi</option>
                    <option value="2">Mercredi</option>
                    <option value="3">Jeudi</option>
                    <option value="4">Vendredi</option>
                    <option value="5">Samedi</option>
                  </select>
                </label>
                <label>D√©but
                  <input type="time" id="planningArretStart" />
                </label>
                <label>Dur√©e (min)
                  <input type="number" id="planningArretDuration" min="0" />
                </label>
                <label>Commentaire
                  <input type="text" id="planningArretComment" />
                </label>
              </div>
              <button class="secondary-btn" id="planningArretAddBtn">Ajouter l'arr√™t</button>
            </details>

            <details open>
              <summary>Cadences articles</summary>
              <div class="form-grid">
                <label>Code article
                  <input type="text" id="planningArticleCode" />
                </label>
                <label>Libell√©
                  <input type="text" id="planningArticleLabel" />
                </label>
                <label>Poids colis (kg)
                  <input type="number" id="planningArticlePoids" step="0.01" min="0" />
                </label>
                <label>Cadence (colis/h)
                  <input type="number" id="planningArticleCadence" step="0.01" min="0" />
                </label>
                <label>Ligne par d√©faut
                  <select id="planningArticleLine"></select>
                </label>
              </div>
              <button class="secondary-btn" id="planningArticleAddBtn">Enregistrer la cadence</button>
              <div class="planning-mini-table" id="planningCadenceList"></div>
            </details>

            <details open>
              <summary>Ordres de fabrication (OF)</summary>
              <div class="form-grid">
                <label>Code article
                  <input type="text" id="planningOFCode" list="planningArticleCodesList" />
                  <datalist id="planningArticleCodesList"></datalist>
                </label>
                <label>Ligne
                  <select id="planningOFLine"></select>
                </label>
                <label>Quantit√© (colis)
                  <input type="number" id="planningOFQty" min="0" />
                </label>
                <label>D√©but (jour + heure)
                  <div class="planning-inline">
                    <select id="planningOFDay">
                      <option value="0">Lundi</option>
                      <option value="1">Mardi</option>
                      <option value="2">Mercredi</option>
                      <option value="3">Jeudi</option>
                      <option value="4">Vendredi</option>
                      <option value="5">Samedi</option>
                    </select>
                    <input type="time" id="planningOFStart" />
                  </div>
                </label>
                <label>Cadence (colis/h)
                  <input type="number" id="planningOFcadence" step="0.01" min="0" placeholder="auto" />
                </label>
              </div>
              <button class="primary-btn" id="planningOFAddBtn">Ajouter l'OF</button>
              <p class="helper-text" id="planningOFPrereq">Enregistre d'abord les cadences articles pour activer la cr√©ation d'OF.</p>
              <p class="helper-text">Pas de chevauchement sur une m√™me ligne : recalage automatique.</p>
            </details>
          </div>
        </div>

        <div class="card">
          <h3>Construction planning (Gantt)</h3>
          <div class="planning-legend">
            <span class="legend-item"><span class="legend-dot planned"></span>Non d√©marr√©</span>
            <span class="legend-item"><span class="legend-dot running"></span>En production</span>
            <span class="legend-item"><span class="legend-dot done"></span>Termin√©</span>
            <span class="legend-item"><span class="legend-dot blocked"></span>Bloqu√©</span>
            <span class="legend-item"><span class="legend-dot stop"></span>Arr√™t planifi√©/observ√©</span>
          </div>
          <div id="planningGantt" class="gantt-wrapper"></div>
          <div class="planning-actions-row">
            <button class="secondary-btn" id="planningScrollTopBtn">Haut de page</button>
            <button class="secondary-btn" id="planningShowDelaysBtn">Recalculer avance/retard</button>
          </div>
        </div>

        <div class="card">
          <h3>Lancer un planning valid√©</h3>
          <div class="form-grid">
            <label>Semaine √† lancer
              <input type="number" id="planningLaunchWeek" min="1" max="53" />
            </label>
          </div>
          <div class="buttons-row">
            <button class="primary-btn" id="planningLaunchBtn">Lancer le planning</button>
          </div>
          <div class="table-wrapper" style="margin-top: 10px;">
            <div id="planningSavedList" class="planning-mini-table"></div>
          </div>
        </div>

        <div class="card">
          <h3>Avance / Retard lignes</h3>
          <div id="planningDelays" class="planning-delays"></div>
        </div>
      </div>

      <div id="planningBlockEditor" class="modal" hidden>
        <div class="modal-content">
          <h3>Modifier le bloc</h3>
          <div class="form-grid">
            <label>Quantit√© (colis)
              <input type="number" id="planningEditQty" min="0" />
            </label>
            <label>D√©but
              <input type="datetime-local" id="planningEditStart" />
            </label>
            <label>Fin
              <input type="datetime-local" id="planningEditEnd" />
            </label>
            <label>Status
              <select id="planningEditStatus">
                <option value="planned">Non d√©marr√©</option>
                <option value="running">En production</option>
                <option value="done">Termin√©</option>
                <option value="blocked">Bloqu√©</option>
              </select>
            </label>
            <label>Raison blocage
              <input type="text" id="planningEditBlockReason" />
            </label>
          </div>
          <div class="buttons-row">
            <button class="primary-btn" id="planningEditSaveBtn">Enregistrer</button>
            <button class="secondary-btn" id="planningEditCancelBtn">Fermer</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PANNEAU PARAM√àTRES -->
    <div id="settingsPanel" class="settings-panel hidden">
      <div class="settings-panel__header">
        <h3>Param√®tres</h3>
        <button id="settingsClose" class="icon-btn" aria-label="Fermer">‚úï</button>
      </div>
      <p class="helper-text">Mot de passe local, th√®me et options rapides. Rien n'est envoy√© en ligne.</p>

      <div class="settings-grid">
        <div class="card compact">
          <h4>Acc√®s Manager</h4>
          <form id="settingsCreatePasswordForm" class="manager-security-form">
            <label for="settingsCreatePassword">Cr√©er le mot de passe</label>
            <input type="password" id="settingsCreatePassword" placeholder="Mot de passe" />
            <input type="password" id="settingsCreatePasswordConfirm" placeholder="Confirmation" />
            <button type="submit" class="secondary-btn">üíæ Enregistrer</button>
          </form>

          <form id="settingsChangePasswordForm" class="manager-security-form">
            <label for="settingsOldPassword">Modifier le mot de passe</label>
            <input type="password" id="settingsOldPassword" placeholder="Ancien mot de passe" />
            <input type="password" id="settingsNewPassword" placeholder="Nouveau mot de passe" />
            <input type="password" id="settingsNewPasswordConfirm" placeholder="Confirmer le nouveau" />
            <button type="submit" class="secondary-btn">üîê Mettre √† jour</button>
          </form>

          <div id="settingsSecurityStatus" class="import-status helper-text"></div>
        </div>

        <div class="card compact">
          <h4>Dossier des fichiers Excel</h4>
          <p class="helper-text">Imports, exports et historique utilisent ce dossier (ex : honor200 ‚ûú Documents).</p>
          <div class="settings-folder-row">
            <div>
              <p id="settingsFolderPath" class="helper-text folder-path">Dossier actuel : Documents</p>
              <div id="settingsFolderStatus" class="import-status helper-text"></div>
            </div>
            <button id="settingsFolderBtn" class="secondary-btn" type="button">üìÅ Choisir le dossier</button>
          </div>
        </div>

        <div class="card compact">
          <h4>Affichage</h4>
          <div class="settings-toggle-row">
            <span>Th√®me clair / sombre</span>
            <button id="settingsThemeBtn" class="secondary-btn" type="button">Basculer</button>
          </div>
          <div class="settings-toggle-row">
            <span>R√©duire le bandeau</span>
            <label class="switch">
              <input type="checkbox" id="headerCompactToggle" checked />
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <div id="managerUnlockModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="managerUnlockTitle">
      <div class="modal__content">
        <div class="modal__header">
          <h3 id="managerUnlockTitle">Acc√®s Manager</h3>
          <button id="managerUnlockClose" class="icon-btn" aria-label="Fermer">‚úï</button>
        </div>
        <p class="helper-text">Saisis le mot de passe pour afficher la page Manager (par d√©faut : 3005 tant qu'il n'est pas chang√©).</p>
        <form id="managerUnlockForm" class="manager-security-form">
          <input type="password" id="managerUnlockInput" placeholder="Mot de passe" autocomplete="current-password" />
          <div class="modal__actions">
            <button type="submit" class="primary-btn">Valider</button>
            <button type="button" id="managerUnlockCancel" class="secondary-btn">Annuler</button>
          </div>
        </form>
        <div id="managerUnlockStatus" class="import-status helper-text"></div>
      </div>
    </div>

    <!-- CALCULATRICE FLOTTANTE -->
    <div id="calculator" class="calculator hidden">
      <div class="calc-header">
        <span>Calculatrice</span>
        <button id="calcCloseBtn" class="calc-close-btn">‚úï</button>
      </div>

      <input type="text" id="calcDisplay" class="calc-display" readonly />

      <div class="calc-grid">
        <button class="calc-btn" data-value="7">7</button>
        <button class="calc-btn" data-value="8">8</button>
        <button class="calc-btn" data-value="9">9</button>
        <button class="calc-btn op" data-value="/">√∑</button>

        <button class="calc-btn" data-value="4">4</button>
        <button class="calc-btn" data-value="5">5</button>
        <button class="calc-btn" data-value="6">6</button>
        <button class="calc-btn op" data-value="*">√ó</button>

        <button class="calc-btn" data-value="1">1</button>
        <button class="calc-btn" data-value="2">2</button>
        <button class="calc-btn" data-value="3">3</button>
        <button class="calc-btn op" data-value="-">‚àí</button>

        <button class="calc-btn" data-value="0">0</button>
        <button class="calc-btn" data-value=".">.</button>
        <button class="calc-btn" data-action="clear">C</button>
        <button class="calc-btn op" data-value="+">+</button>

        <button class="calc-btn equals" data-action="equals">=</button>
      </div>
    </div>

    <button id="calcToggle" class="calculator-toggle">üßÆ</button>

  </main>

  <!-- SCRIPT PRINCIPAL -->
  <script src="app.js"></script>
</body>
</html>

